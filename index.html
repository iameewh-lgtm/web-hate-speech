<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hate Speech Detector (Colab)</title>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .card { background: #1e293b; padding: 30px; border-radius: 16px; border: 1px solid #334155; width: 100%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        label { font-size: 14px; color: #94a3b8; display: block; margin-bottom: 8px; font-weight: bold; }
        input, textarea { width: 100%; background: #0f172a; color: white; border: 1px solid #334155; padding: 12px; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 20px; outline: none; }
        input:focus, textarea:focus { border-color: #3b82f6; }
        
        button { width: 100%; padding: 14px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        button:hover { background: #2563eb; }
        button:disabled { background: #475569; cursor: wait; }

        .result-box { margin-top: 20px; padding: 20px; background: #0f172a; border-radius: 8px; display: none; }
        .badge { padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 14px; }
        .clean { color: #4ade80; border: 1px solid #4ade80; background: rgba(74, 222, 128, 0.1); }
        .toxic { color: #f87171; border: 1px solid #f87171; background: rgba(248, 113, 113, 0.1); }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; margin-top:0">K·∫øt n·ªëi Google Colab</h2>

    <label>üîó D√°n Link Ngrok (t·ª´ Colab) v√†o ƒë√¢y:</label>
    <input type="text" id="serverUrl" placeholder="V√≠ d·ª•: https://xxxx-xx-xx.ngrok-free.app">

    <label>üí¨ Nh·∫≠p n·ªôi dung c·∫ßn ki·ªÉm tra:</label>
    <textarea id="inp" rows="3" placeholder="Nh·∫≠p th·ª≠: cmn, vcl, dkm..."></textarea>

    <button id="btn" onclick="check()">PH√ÇN T√çCH</button>

    <div class="result-box" id="res">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span id="lbl" class="badge">...</span>
            <span id="score" style="color:#94a3b8"></span>
        </div>
        <p id="desc" style="color:#cbd5e1; margin-top:10px; font-size:14px; font-style:italic;"></p>
    </div>
</div>

<script>
    async function check() {
        // L·∫•y link t·ª´ √¥ nh·∫≠p v√† x√≥a kho·∫£ng tr·∫Øng th·ª´a
        let url = document.getElementById('serverUrl').value.trim();
        const txt = document.getElementById('inp').value.trim();
        const btn = document.getElementById('btn');
        const res = document.getElementById('res');

        if (!url) return alert("‚ùå Ch∆∞a nh·∫≠p Link Ngrok! H√£y copy t·ª´ Colab d√°n v√†o.");
        if (!txt) return alert("‚ùå Ch∆∞a nh·∫≠p n·ªôi dung ki·ªÉm tra!");

        // X·ª≠ l√Ω link: ƒë·∫£m b·∫£o kh√¥ng c√≥ d·∫•u / ·ªü cu·ªëi r·ªìi th√™m /predict
        // V√≠ d·ª•: https://abc.ngrok.app/ -> https://abc.ngrok.app/predict
        url = url.replace(/\/$/, ""); 
        const apiEndpoint = url + "/predict";

        btn.innerText = "‚è≥ ƒêang g·ª≠i sang Colab..."; 
        btn.disabled = true; 
        res.style.display = 'none';

        try {
            const response = await fetch(apiEndpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ inputs: txt })
            });

            if (!response.ok) {
                throw new Error("L·ªói k·∫øt n·ªëi! Ki·ªÉm tra l·∫°i Link Ngrok.");
            }

            const data = await response.json();
            
            // T√¨m nh√£n c√≥ ƒëi·ªÉm cao nh·∫•t
            // Data tr·∫£ v·ªÅ th∆∞·ªùng l√† m·∫£ng c√°c nh√£n: [{label:..., score:...}, ...]
            // C·∫ßn sort ƒë·ªÉ l·∫•y c√°i score cao nh·∫•t
            let top;
            if (Array.isArray(data)) {
                 data.sort((a, b) => b.score - a.score);
                 top = data[0];
            } else {
                top = data; // Tr∆∞·ªùng h·ª£p tr·∫£ v·ªÅ 1 object
            }

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            const map = {
                "LABEL_0": { t: "‚úÖ S·∫†CH (CLEAN)", c: "clean", d: "N·ªôi dung an to√†n, kh√¥ng vi ph·∫°m." },
                "LABEL_1": { t: "‚ö†Ô∏è X√öC PH·∫†M", c: "toxic", d: "Ph√°t hi·ªán t·ª´ ng·ªØ th√¥ t·ª•c ho·∫∑c c√¥ng k√≠ch." },
                "LABEL_2": { t: "‚õî TH√ô GH√âT", c: "toxic", d: "N·ªôi dung k√≠ch ƒë·ªông th√π h·∫±n, r·∫•t nguy hi·ªÉm." }
            };
            
            // N·∫øu AI tr·∫£ v·ªÅ label kh√°c th√¨ m·∫∑c ƒë·ªãnh coi l√† LABEL_1 (Toxic nh·∫π)
            const info = map[top.label] || map["LABEL_1"];

            document.getElementById('lbl').innerText = info.t;
            document.getElementById('lbl').className = "badge " + info.c;
            document.getElementById('score').innerText = "ƒê·ªô tin c·∫≠y: " + (top.score * 100).toFixed(1) + "%";
            document.getElementById('desc').innerText = info.d;
            res.style.display = 'block';

        } catch (e) {
            alert("‚ùå KH√îNG K·∫æT N·ªêI ƒê∆Ø·ª¢C!\n\n1. ƒê·∫£m b·∫£o Colab ƒëang ch·∫°y (c√≥ n√∫t Stop quay quay).\n2. Link Ngrok ph·∫£i ch√≠nh x√°c (copy l·∫°i xem).\n3. Link Ngrok thay ƒë·ªïi m·ªói l·∫ßn ch·∫°y l·∫°i Colab.");
            console.error(e);
        }
        
        btn.innerText = "PH√ÇN T√çCH"; 
        btn.disabled = false;
    }
</script>

</body>
</html>
