<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Content Filter</title>
    <style>
        body { background: #050505; color: #ededed; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .card { background: #121212; padding: 30px; border-radius: 16px; border: 1px solid #333; width: 400px; }
        textarea { width: 100%; background: #000; color: white; padding: 10px; border: 1px solid #333; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; margin-top: 15px; padding: 12px; background: #ededed; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #res { margin-top: 20px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center">Ki·ªÉm Tra Hate Speech</h2>
    <textarea id="inp" rows="4" placeholder="Nh·∫≠p c√¢u v√†o ƒë√¢y..."></textarea>
    <button id="btn" onclick="run()">PH√ÇN T√çCH</button>
    <div id="res">
        K·∫øt qu·∫£: <b id="lbl">...</b> <span id="score"></span>
    </div>
</div>

<script>
    async function run() {
        const txt = document.getElementById('inp').value.trim();
        const btn = document.getElementById('btn');
        const res = document.getElementById('res');

        // üëáüëáüëá D√ÅN TOKEN C·ª¶A B·∫†N V√ÄO ƒê√ÇY üëáüëáüëá
        const TOKEN = "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"; 

        if(!txt) return alert("Nh·∫≠p n·ªôi dung ƒëi b·∫°n!");
        
        btn.innerText = "‚è≥ ƒêang x·ª≠ l√Ω..."; btn.disabled = true;

        try {
            // G·ªçi v√†o ƒë∆∞·ªùng d·∫´n ·∫£o /api/proxy (Do file vercel.json qu·∫£n l√Ω)
            const req = await fetch("/api/proxy", {
                method: "POST",
                headers: { 
                    "Authorization": `Bearer ${TOKEN}`, 
                    "Content-Type": "application/json" 
                },
                body: JSON.stringify({ inputs: txt })
            });

            if (!req.ok) {
                const err = await req.text();
                if (req.status === 404) {
                    alert("‚ùå L·ªói 404: Vercel ch∆∞a nh·∫≠n file vercel.json.\nL√Ω do: B·∫°n ƒë·∫∑t t√™n file sai (v√≠ d·ª• vercel.json.txt). H√£y s·ª≠a l·∫°i t√™n file!");
                } else if (req.status === 503) {
                    alert("üí§ Model ƒëang kh·ªüi ƒë·ªông (Cold Boot). ƒê·ª£i 20s r·ªìi b·∫•m l·∫°i!");
                } else {
                    alert(`‚ùå L·ªói ${req.status}: ${err}`);
                }
                reset(); return;
            }

            const data = await req.json();
            // X·ª≠ l√Ω k·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ Router (th∆∞·ªùng l√† m·∫£ng m·∫£ng [[{...}]])
            const preds = Array.isArray(data[0]) ? data[0] : data;
            
            // S·∫Øp x·∫øp ƒëi·ªÉm cao nh·∫•t
            preds.sort((a,b) => b.score - a.score);
            const top = preds[0];

            document.getElementById('lbl').innerText = top.label;
            document.getElementById('score').innerText = `(${Math.round(top.score*100)}%)`;
            res.style.display = 'block';

        } catch (e) {
            alert("L·ªói k·∫øt n·ªëi: " + e.message);
        }
        reset();
    }

    function reset() { 
        document.getElementById('btn').innerText = "PH√ÇN T√çCH"; 
        document.getElementById('btn').disabled = false; 
    }
</script>

</body>
</html>