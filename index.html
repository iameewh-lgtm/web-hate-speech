<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hate Speech Detector (No-Server)</title>
    <style>
        body { background-color: #0a0a0a; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .box { background: #1a1a1a; padding: 30px; border-radius: 12px; border: 1px solid #333; width: 90%; max-width: 450px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; background: #2a2a2a; border: 1px solid #444; color: #fff; border-radius: 6px; margin-bottom: 15px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #0070f3; }
        button { width: 100%; padding: 12px; background: #0070f3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        button:hover { background: #0051a2; }
        button:disabled { background: #444; cursor: not-allowed; }
        #result { margin-top: 20px; font-weight: bold; min-height: 24px; }
        .err { color: #ff4444; font-size: 12px; margin-top: 10px; }
    </style>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
</head>
<body>

<div class="box">
    <h2 style="margin-top:0; color:#888;">CHECK TEENCODE</h2>
    <p style="font-size: 12px; color: #555">Ch·∫°y tr·ª±c ti·∫øp tr√™n tr√¨nh duy·ªát</p>
    <input type="text" id="inp" placeholder="Nh·∫≠p: cdmm, c.o.n.m.e, vcl...">
    <button id="btn">PH√ÇN T√çCH</button>
    <div id="result"></div>
    <div id="debug" class="err"></div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    // üëáüëáüëá D√ÅN API KEY V√ÄO GI·ªÆA 2 D·∫§U NGO·∫∂C K√âP üëáüëáüëá
    const API_KEY = "AIzaSyDz-WxEJjP84yzecNi8_J_I6LTZx_UKDME"; 

    const btn = document.getElementById('btn');
    const inp = document.getElementById('inp');
    const res = document.getElementById('result');
    const debug = document.getElementById('debug');

    btn.addEventListener('click', async () => {
        const txt = inp.value.trim();
        if (!txt) return;

        btn.innerText = "ƒêANG X·ª¨ L√ù...";
        btn.disabled = true;
        res.innerHTML = "";
        debug.innerText = "";

        try {
            // --- 1. D·ªäCH TEENCODE (X·ª≠ l√Ω ngay t·∫°i tr√¨nh duy·ªát) ---
            let clean = txt.toLowerCase();
            clean = clean.replace(/\./g, ''); // X√≥a ch·∫•m
            clean = clean.replace(/(?<=\b[a-z])\s+(?=[a-z]\b)/g, ''); // G·ªôp ch·ªØ
            
            const dict = {
                "cc": "c·ª•c c·ª©t", "cmm": "con m·∫π m√†y", "dcm": "ƒë·ªãt con m·∫π",
                "dm": "ƒë·ªãt m·∫π", "ƒëm": "ƒë·ªãt m·∫π", "vcl": "v√£i c·∫£ l·ªìn",
                "vl": "v√£i l·ªìn", "clm": "c√°i l·ªù m√°", "cdmm": "con ƒëƒ© m·∫π m√†y",
                "cdcmm": "con ƒëƒ© c√°i m·∫π m√†y", "cmn": "con m·∫π n√≥", "dell": "ƒë√©o"
            };
            clean = clean.split(' ').map(w => dict[w] || w).join(' ');
            
            console.log("ƒê√£ d·ªãch:", clean);

            // --- 2. G·ªåI GOOGLE ---
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

            const prompt = `Ph√¢n lo·∫°i c√¢u: "${clean}" (G·ªëc: "${txt}"). 
            Ch·ªâ tr·∫£ v·ªÅ JSON: {"label": "LABEL_0" (s·∫°ch) ho·∫∑c "LABEL_1" (x√∫c ph·∫°m) ho·∫∑c "LABEL_2" (th√π gh√©t)}`;

            const result = await model.generateContent(prompt);
            const response = await result.response;
            let text = response.text().replace(/```json|```/g, '').trim();
            
            // L·∫•y JSON
            const first = text.indexOf('{');
            const last = text.lastIndexOf('}');
            if (first !== -1 && last !== -1) text = text.substring(first, last + 1);
            
            const data = JSON.parse(text);

            // --- 3. HI·ªÇN TH·ªä ---
            if (data.label === 'LABEL_2') 
                res.innerHTML = `<span style="color:#ff4444; font-size:1.2em">‚õî TH√ô GH√âT</span>`;
            else if (data.label === 'LABEL_1') 
                res.innerHTML = `<span style="color:#ffbb33; font-size:1.2em">‚ö†Ô∏è X√öC PH·∫†M</span>`;
            else 
                res.innerHTML = `<span style="color:#00c851; font-size:1.2em">‚úÖ AN TO√ÄN</span>`;

        } catch (e) {
            console.error(e);
            // N·∫øu Google ch·∫∑n (Safety Block), ta t·ª± coi ƒë√≥ l√† Toxic
            if (e.message.includes("SAFETY") || e.message.includes("candidate")) {
                 res.innerHTML = `<span style="color:#ff4444; font-size:1.2em">‚õî C·ª∞C K·ª≤ ƒê·ªòC H·∫†I (Google Blocked)</span>`;
            } else {
                 debug.innerText = "L·ªói: " + e.message;
            }
        }
        
        btn.innerText = "PH√ÇN T√çCH";
        btn.disabled = false;
    });
</script>

</body>
</html>
